---
author: David Carslaw
---

# Polar annulus 污染变化环形图 {#sec-polarAnnulus}

## 目的 {#sec-polarAnnulusBack}

`polarAnnulus` 函数同于展示在各风向上污染物浓度随时间的变化。这是传统的日变化、周变化、季节变化和趋势变化的一种新的可视化方式。之所以使用环形而不是实心圆，是为了避免圆心附近数据看不清的问题。污染变化环形图可以帮助我们认识污染的来源，尤其是将多种污染物放在一起进行联合分析的时候。

## 实例 {#sec-examAnnulus}

我们用 `polarAnnulus` 为Marylebone路边交通点的 PM~10~ 绘制了四张不同污染变化环形图。@fig-polarAnnulus 显示了这四种不同的时间分析维度。和之前对于这个站点 PM~10~ 的分析类似，从趋势环形图上看，偏南风条件下的浓度更高（图中偏红的颜色），并且这个规律在1998至2005年间几乎没有变化。在季节变化（年变化）环形图中，我们看到二三月间偏东风所贡献的浓度最高，在夏秋季偏南风和西南风则更为突出。在周变化环形图中可以清晰的看到在所有风向上，工作日都有明显的浓度峰值，而周末两天则没有这个特征。最后的日变化环形图明确显示高污染浓度出现在早6时至晚18时之间。


有意思的是在 NO~x~ 和 CO 的污染变化环形图中（没有展示，但是可以用上图类似方法获得）东南风的贡献并不是特别明显。这就可以让我们初步判断出颗粒物的污染来自于独立的污染源（非附近交通源）。一种解释是偏东气流下出现的高污染来自长距离传输的作用。但是从 @fig-polarAnnulus 中的日变化环形图中可以看到，在东南风向上日夜变化剧烈，其中夜间浓度非常低，又体现出交通源主导的特征。这样剧烈的日夜变化基本上可以排除是受长距离传输的影响，因为长距离传输会使得污染物充分的混合同时也为二次颗粒物的生成提供了时间。从周变化环形图上我们也同样可以看到尖锐的浓度变化，并没有长距离传输影响应该体现出相对平缓的污染变化。以上分析可以得到以下结论，即东南方向上存在交通源以外的本地污染源。做出最终的判断还需要做更详细的分析和证明，但是应该已经可以看出不同时间维度的污染变化环形图的威力了。

```{r}
#| label: fig-polarAnnulus
#| fig-cap: 使用 `polarAnnulus` 函数为Marylebone路边交通点绘制的污染变化环形图。
#| fig-subcap: 
#|   - "By trend."
#|   - "By season."
#|   - "By weekday."
#|   - "By hour."
#| layout-ncol: 2
#| fig-width: 5
#| fig-height: 4.2
#| fig-show: hold
library(openair) # load openair
polarAnnulus(mydata, 
             pollutant = "pm10", 
             period = "trend", 
             main = "Trend")

polarAnnulus(mydata, 
             pollutant = "pm10", 
             period = "season", 
             main = "Season")

polarAnnulus(mydata, 
             pollutant = "pm10", 
             period = "weekday", 
             main = "Weekday")

polarAnnulus(mydata, 
             pollutant = "pm10",
             period = "hour", 
             main = "Hour")
```

在我们做风向与污染浓度关联分析的过程中，很多时候需要对风速条件做一些取舍。当风速很小的时候，风向会变的极不稳定（同时也是高污染经常发生的时候）。所以我们在分析前可以考虑剔除小风条件下的监测数据。下面的代码提供了使用 [dplyr]{.pkg} 包的 `filter` 函数进行数据过滤的两个例子。前面一个是选择风速大于 \>2 m s^-1^ 的数据。后面一个是嵌套使用 `quantile` 函数选择风速大于10百分位的数据。相比而言后者会更有用一些，因为这种筛选方式可以让我们控制选定数据的数量，在这个例子中即90%。我们需要谨慎的进行数据剔除以防漏掉小风条件下数据中也可能存在的重要信息，所以最好尝试不同筛选方案并进行对比。

```{r}
#| label: polarAnnSub
#| eval: false
## wind speed >2
polarAnnulus(filter(mydata, ws > 2), 
             pollutant = "pm10", 
             type = "hour")

## wind speed > 10th percentile
polarAnnulus(filter(
  mydata, 
  ws > quantile(ws, probs = 0.1, na.rm = TRUE)
  ),
  pollutant ="pm10", 
  type = "hour")
```
